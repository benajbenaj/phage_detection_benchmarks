rule all:
    input:
        expand(
            "{s}/{a}_{m}_reads_R1.fastq",
            s=config["simulated_dir"],
            m=config["model"],
            a=config["abundances"],
        ),
        expand(
            "{s}/{a}_{m}_reads_R2.fastq",
            s=config["simulated_dir"],
            m=config["model"],
            a=config["abundances"],
        ),

rule simulate_reads:
    input:
        genomes=config["genomes"],
    output:
        config["simulated_dir"] + "/{abundance}_{model}_reads_R1.fastq",
        config["simulated_dir"] + "/{abundance}_{model}_reads_R2.fastq",
    params:
        simulator=config["simulator"],
        simulated_dir=config["simulated_dir"],
        cpus=config["simulator_cpus"],
        reads=config["n_reads"],
    shell:
        """
        source ~/.bashrc
        source activate insilicoseq_env

        {params.simulator} {params.cpus} {params.reads} --model {wildcards.model} --abundance_file profiles/profile_{wildcards.abundance}.txt --output {params.simulated_dir}/{wildcards.abundance}_{wildcards.model}_reads --genomes {input.genomes}
        """
